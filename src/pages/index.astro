---
import BaseLayout from "../layouts/BaseLayout.astro";
import Grid from "../components/Grid.astro";
import Hero from "../components/Hero.astro";
import Icon from "../components/Icon.astro";
import Pill from "../components/Pill.astro";
import PortfolioPreview from "../components/PortfolioPreview.astro";
import ContactCTA from "../components/ContactCTA.astro";
import { skills } from "../data/skills";
import { getSocialLinksFor } from "../data/social";
import { siteConfig } from "../data/site";
import { getPublishedProjects } from "../data/projects";

const projects = (await getPublishedProjects()).slice(0, 2);

const homeLinks = getSocialLinksFor("home");
---

<BaseLayout>
	<div class="stack gap-20 lg:gap-48">
		<!-- Hero -->
		<div class="wrapper stack gap-8 lg:gap-20">
			<header class="hero">
				<Hero
					title={`Hello, I'm ${siteConfig.name}.`}
					tagline="Robot Developer who bridges hardware and software to build real-world robotic systems."
					align="start"
				>
					<div class="roles">
						<Pill><Icon icon="code" size="1.33em" /> Robot Developer</Pill>
						<Pill><Icon icon="strategy" size="1.33em" /> Embedded Engineer</Pill>
						<Pill><Icon icon="trophy" size="1.33em" /> Problem Solver</Pill>
					</div>
				</Hero>

				<img
					alt={`Portrait of ${siteConfig.name}`}
					width="360"
					height="465"
					src="assets/portrait.jpg"
				/>
			</header>
		</div>

		<main class="wrapper stack gap-20 lg:gap-48">
			<!-- Tech Stack -->
			<section class="tech-section">
				<h3 class="section-title">Tech Stack</h3>
				<div class="skills-grid">
					{skills.map((group, i) => (
						<div class="skill-group" style={`--group-index: ${i}`}>
							<div class="skill-accent-bar"></div>
							<div class="skill-body">
								<h4 class="skill-category">{group.category}</h4>
								<div class="skill-items">
									{group.items.map((item) => (
										<span class="skill-pill">{item}</span>
									))}
								</div>
							</div>
						</div>
					))}
				</div>
			</section>

			<!-- Latest Projects -->
			<section class="section with-background bg-variant">
				<h3 class="section-title">Latest Projects</h3>

				<div class="gallery">
					<Grid variant="offset">
						{projects.map((project) => (
							<li>
								<PortfolioPreview project={project} />
							</li>
						))}
					</Grid>
				</div>

			</section>

			<!-- Connect -->
			<section class="section with-background bg-variant">
				<h3 class="section-title">Connect</h3>

				<div class="gallery">
					<Grid variant="small">
						{homeLinks.map((link) => (
							<a
								href={link.href}
								target={link.href.startsWith("mailto:") ? undefined : "_blank"}
								class="contact-card"
							>
								<Icon icon={link.icon} size="2.5rem" />
								<p>{link.label}</p>
							</a>
						))}
					</Grid>
				</div>
			</section>
		</main>

		<ContactCTA />
	</div>
</BaseLayout>

<style>
	/* ─── Hero ─────────────────────────────────── */
	.hero {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 2rem;
	}

	.roles {
		display: none;
	}

	.hero img {
		aspect-ratio: 5 / 4;
		object-fit: cover;
		object-position: top;
		border-radius: 1.5rem;
		box-shadow: var(--shadow-md);
	}

	@media (min-width: 50em) {
		.hero {
			display: grid;
			grid-template-columns: 6fr 4fr;
			padding-inline: 2.5rem;
			gap: 3.75rem;
		}

		.roles {
			margin-top: 0.5rem;
			display: flex;
			gap: 0.5rem;
		}

		.hero img {
			aspect-ratio: 3 / 4;
			border-radius: 4.5rem;
			object-fit: cover;
		}
	}

	/* ─── Section Title ────────────────────────── */
	.section-title {
		font-size: var(--text-2xl);
		color: var(--gray-0);
		margin-bottom: 1.5rem;
	}

	/* ─── Tech Stack ──────────────────────────── */
	.tech-section {
		position: relative;
	}

	.skills-grid {
		display: grid;
		grid-template-columns: 1fr;
		gap: 1rem;
	}

	@media (min-width: 50em) {
		.skills-grid {
			grid-template-columns: repeat(2, 1fr);
			gap: 1.25rem;
		}
	}

	@media (min-width: 72em) {
		.skills-grid {
			grid-template-columns: repeat(3, 1fr);
		}
	}

	.skill-group {
		display: flex;
		overflow: hidden;
		border-radius: 0.75rem;
		border: 1px solid var(--gray-800);
		background: var(--gray-999_40);
		transition: transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease;
		animation: fadeSlideUp 0.4s ease both;
		animation-delay: calc(0.08s * var(--group-index, 0));
	}

	.skill-group:hover {
		transform: translateY(-4px);
		box-shadow: var(--shadow-md);
		border-color: var(--accent-regular);
	}

	@keyframes fadeSlideUp {
		from {
			opacity: 0;
			transform: translateY(12px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	.skill-accent-bar {
		width: 4px;
		flex-shrink: 0;
		background: var(--gradient-accent);
	}

	.skill-body {
		padding: 1.25rem 1.5rem;
		display: flex;
		flex-direction: column;
		gap: 0.75rem;
		flex: 1;
	}

	.skill-category {
		font-size: var(--text-md);
		color: var(--gray-0);
		margin: 0;
		font-weight: 700;
		letter-spacing: 0.02em;
	}

	.skill-items {
		display: flex;
		flex-wrap: wrap;
		gap: 0.4rem;
	}

	.skill-pill {
		padding: 0.3rem 0.7rem;
		font-size: var(--text-sm);
		border-radius: 0.4rem;
		color: var(--gray-200);
		background-color: var(--gray-999_40);
		border: 1px solid var(--gray-800);
		transition: color 0.2s ease, border-color 0.2s ease;
	}

	.skill-group:hover .skill-pill {
		border-color: var(--accent-overlay);
		color: var(--gray-100);
	}

	/* ─── Section Layout ──────────────────────── */
	.section {
		display: grid;
		gap: 0.75rem;
	}

	.with-background {
		position: relative;
	}

	.with-background::before {
		--hero-bg: var(--bg-image-subtle-2);
		content: "";
		position: absolute;
		pointer-events: none;
		left: 50%;
		width: 100vw;
		aspect-ratio: calc(2.25 / var(--bg-scale));
		top: 0;
		transform: translateY(-75%) translateX(-50%);
		background:
			url("/assets/backgrounds/noise.png") top center/220px repeat,
			var(--hero-bg) center center / var(--bg-gradient-size) no-repeat,
			var(--gray-999);
		background-blend-mode: overlay, normal, normal, normal;
		mix-blend-mode: var(--bg-blend-mode);
		z-index: -1;
	}

	.with-background.bg-variant::before {
		--hero-bg: var(--bg-image-subtle-1);
	}

	@media (min-width: 50em) {
		.section {
			grid-template-columns: repeat(4, 1fr);
			grid-template-areas: "header header header header" "gallery gallery gallery gallery";
			gap: 2rem;
		}

		.gallery {
			grid-area: gallery;
		}
	}

	/* ─── Contact Card ────────────────────────── */
	.contact-card {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: 0.75rem;
		padding: 1.5rem;
		border: 1px solid var(--gray-800);
		border-radius: 1.5rem;
		background-color: var(--gray-999_40);
		box-shadow: var(--shadow-sm);
		text-decoration: none;
		color: var(--gray-300);
		transition: all 0.3s ease;
	}

	.contact-card:hover {
		transform: translateY(-3px);
		box-shadow: var(--shadow-md);
		color: var(--gray-0);
	}

	.contact-card [data-icon] {
		color: var(--accent-regular);
	}

	.contact-card p {
		margin: 0;
		font-size: var(--text-md);
		line-height: 1.3;
	}

	.gallery {
		width: 100%;
	}

	li {
		list-style: none;
	}
</style>


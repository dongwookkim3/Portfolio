---
import BaseLayout from "../layouts/BaseLayout.astro";

import ContactCTA from "../components/ContactCTA.astro";
import PortfolioPreview from "../components/PortfolioPreview.astro";
import Hero from "../components/Hero.astro";
import Grid from "../components/Grid.astro";
import { pageTitle } from "../data/site";
import { getPublishedProjects } from "../data/projects";

const projects = await getPublishedProjects();

const categories = ["all", ...new Set(projects.map((p) => p.data.category ?? "etc"))];
---

<BaseLayout
	title={pageTitle('Project')}
	description="Dongwook Kim's Projects"
>
	<div class="stack gap-20">
		<main class="wrapper stack gap-8">
			<Hero title="Project" align="center" />

			<!-- Category Filter -->
			<nav class="category-filter" aria-label="프로젝트 카테고리 필터">
				{categories.map((cat) => (
					<button
						class={`filter-btn ${cat === "all" ? "active" : ""}`}
						data-category={cat}
					>
						{cat === "all" ? "All" : cat.charAt(0).toUpperCase() + cat.slice(1)}
					</button>
				))}
			</nav>

			<Grid variant="offset">
				{
					projects.map((project) => (
						<li class="project-item" data-category={project.data.category ?? "etc"}>
							<PortfolioPreview project={project} />
						</li>
					))
				}
			</Grid>
		</main>
		<ContactCTA />
	</div>
</BaseLayout>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const buttons = document.querySelectorAll<HTMLButtonElement>(".filter-btn");
		const items = document.querySelectorAll<HTMLLIElement>(".project-item");

		buttons.forEach((btn) => {
			btn.addEventListener("click", () => {
				buttons.forEach((b) => b.classList.remove("active"));
				btn.classList.add("active");

				const category = btn.dataset.category;
				items.forEach((item) => {
					if (category === "all" || item.dataset.category === category) {
						item.style.display = "";
					} else {
						item.style.display = "none";
					}
				});
			});
		});
	});
</script>

<style>
	li {
		list-style: none;
		margin: 0;
		padding: 0;
	}

	:global(.grid) {
		display: grid !important;
		grid-template-columns: repeat(2, 1fr) !important;
		gap: 3rem !important;
	}

	@media (max-width: 50em) {
		:global(.grid) {
			grid-template-columns: 1fr !important;
		}
	}

	/* Category filter */
	.category-filter {
		display: flex;
		justify-content: center;
		flex-wrap: wrap;
		gap: 0.5rem;
		margin-bottom: 1rem;
	}

	.filter-btn {
		padding: 0.4rem 1rem;
		border: 1px solid var(--gray-800);
		border-radius: 999rem;
		background: transparent;
		color: var(--gray-300);
		font-size: var(--text-sm);
		cursor: pointer;
		transition: all 0.2s;
	}

	.filter-btn:hover {
		border-color: var(--accent-regular);
		color: var(--accent-regular);
	}

	.filter-btn.active {
		background: var(--accent-regular);
		color: var(--accent-text-over);
		border-color: var(--accent-regular);
	}
</style>